msrv = "1.90.0"

too-many-arguments-threshold = 5
too-many-lines-threshold = 80
type-complexity-threshold = 100
cognitive-complexity-threshold = 15
excessive-nesting-threshold = 3
max-trait-bounds = 2

future-size-threshold = 8192
pass-by-value-size-limit = 192
too-large-for-stack = 512
stack-size-threshold = 262144
array-size-threshold = 8192
large-error-threshold = 64
enum-variant-size-threshold = 160

allow-dbg-in-tests = false
allow-print-in-tests = false
allow-panic-in-tests = false
allow-unwrap-in-tests = false
allow-expect-in-tests = false
allow-indexing-slicing-in-tests = false
allow-useless-vec-in-tests = false
check-incompatible-msrv-in-tests = true

allow-unwrap-in-consts = false
allow-expect-in-consts = false
suppress-restriction-lint-in-const = false

warn-on-all-wildcard-imports = true
allowed-wildcard-imports = []

avoid-breaking-exported-api = true

doc-valid-idents = [".."]

allowed-scripts = ["Latin"]

min-ident-chars-threshold = 2
allowed-idents-below-min-chars = ["id", "ok", ".."]

single-char-binding-names-threshold = 2
disallowed-names = ["e", "t", "tmp", ".."]

disallowed-macros = [
    { path = "std::print", reason = "no stdout in libs; use tracing/log", allow-invalid = true },
    { path = "std::println", reason = "no stdout in libs; use tracing/log", allow-invalid = true },
    { path = "std::eprint", reason = "no stderr in libs; use tracing/log", allow-invalid = true },
    { path = "std::eprintln", reason = "no stderr in libs; use tracing/log", allow-invalid = true },

    { path = "std::dbg", reason = "no dbg! in libs; use tracing + tests", allow-invalid = true },
    { path = "core::panic", reason = "no panic! in libs; return structured errors", allow-invalid = true },
    { path = "core::todo", reason = "no todo! in libs", allow-invalid = true },

    { path = "core::unimplemented", reason = "no unimplemented! in libs", allow-invalid = true },
    { path = "core::unreachable", reason = "avoid unreachable! in libs; prove invariants or handle error", allow-invalid = true },
]

disallowed-methods = [
    { path = "core::option::Option::unwrap", reason = "no unwrap in libs; use ?/match/if let", allow-invalid = true },
    { path = "core::result::Result::unwrap", reason = "no unwrap in libs; use ?/match", allow-invalid = true },
    { path = "core::option::Option::expect", reason = "no expect in libs; return structured errors", allow-invalid = true },
    { path = "core::result::Result::expect", reason = "no expect in libs; return structured errors", allow-invalid = true },

    { path = "core::option::Option::unwrap_unchecked", reason = "ban unchecked unwrap; invariants must be explicit + audited", allow-invalid = true },
    { path = "core::result::Result::unwrap_unchecked", reason = "ban unchecked unwrap; invariants must be explicit + audited", allow-invalid = true },

    { path = "core::mem::transmute", reason = "ban transmute; prefer safe conversions or explicit unsafe with invariants", allow-invalid = true },
    { path = "std::process::exit", reason = "no process::exit in libraries", allow-invalid = true },

    { path = "std::vec::Vec::leak", reason = "no leaking memory", allow-invalid = true },
    { path = "std::boxed::Box::leak", reason = "no leaking memory", allow-invalid = true },
]

disallowed-types = [
    { path = "std::cell::RefCell", reason = "avoid runtime borrow checks; prefer explicit design or safe sync primitives", allow-invalid = true },
    { path = "std::rc::Rc", reason = "prefer Arc in async/multi-thread contexts", replacement = "std::sync::Arc", allow-invalid = true },

    { path = "std::collections::LinkedList", reason = "avoid LinkedList; prefer Vec/VecDeque", allow-invalid = true },

    { path = "std::sync::mpsc::Sender", reason = "prefer async-friendly channels (flume/crossbeam) by policy", allow-invalid = true },
    { path = "std::sync::mpsc::Receiver", reason = "prefer async-friendly channels (flume/crossbeam) by policy", allow-invalid = true },
]
